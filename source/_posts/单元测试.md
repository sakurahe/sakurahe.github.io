---
title: 单元测试
date: 2019-05-09 10:49:24
tags:
---

## 什么是单元测试

下面是wikipedia对单元测试的解释：

- [英文](https://en.wikipedia.org/wiki/Unit_testing)
- [中文](https://zh.wikipedia.org/wiki/%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95)

## 为什么要单元测试

组件的单元测试有很多好处：
- **提供描述组件行为的文档**。优秀的测试代码会清晰的描述出代码的逻辑关系，从而使不是这个项目的开发者也能够快速的了解代码作用
- **节省手动测试的时间**。单元测试可以在手动测试之前提前发现问题，从而减少手动测试时发生问题的可能性
- **减少bug**。当测试失败时，失败原因无非只有两种，测试代码错误或业务代码错误，在测试代码正确的情况下，可以提前发现业务代码中的错误或bug,快速定位去修复代码
- **促进重构**。重构，每个开发者都经历过。以往，写完一个项目，运行，没什么问题，但是当你改动某个方法后，可能就导致项目运行失败。如果你有单元测试，情况将大不相同。写完一个组件或类，把这个组件或类的单元测试也写了，确保逻辑的正确性，当你写完后整个项目的组件或类后，如果单元测试通过，将很大程度减少运行失败的可能性

当然，测试也有缺点：
- 学习成本比较高
- 会投入大量时间去写测试代码
- 推广和运用单元测试需要较大投入

## 如何进行单元测试

单元测试应该：
- 可以快速运行
- 易于理解
- 只测试一个独立单元的工作

### 使用什么工具进行测试

vue提供了一个组件单元测试的官方库：[Vue Test Utils](https://vue-test-utils.vuejs.org/)

你也可以使用jest来进行测试，它是Facebook开发的一款JavaScript测试框架，拥有以下特点：

- **开箱即用，无需配置**
- **快速的运行测试**。Jest会首先运行以前失败的测试，并根据测试文件所花费的时间重新组织运行。
- **内置Code Coverage**。通过添加 `--coverage` 生成代码覆盖率，不需要额外的设置。Jest可以从整个项目中收集代码覆盖率信息，包括未测试的文件。
- **内置snapshots机制**。轻松地进行跟踪大型对象的测试。snapshots可以与测试一起使用，也可以嵌入到内联中。

具体的[使用文档](https://jestjs.io/docs/en/getting-started)和[api](https://jestjs.io/docs/en/api)，可以查看jest的[官网](https://jestjs.io/)

### 哪些地方需要单元测试

- **短期不会变化的UI组件**
- **逻辑复杂的**
- **不易于理解的**。有的代码时间一久连自己都看不懂了，测试代码有助于理解代码的功能和需求
- **公共代码或组件**
- **核心业务代码**。核心业务代码应该有较高的测试覆盖率
- **api测试**

## 总结

单元测试确实会带给你相当多的好处，但不是立刻体验出来。正如买保险，交了很多保费，没病没痛。单元测试也一样，写了可以买个放心，对代码的一种保障，有bug尽快测出来，没bug就最好。
